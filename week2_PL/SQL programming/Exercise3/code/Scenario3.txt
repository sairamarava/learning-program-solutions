CREATE OR REPLACE PROCEDURE TransferFunds (
    fromAccountID IN NUMBER,
    toAccountID IN NUMBER,
    amount IN NUMBER
) AS
    v_balance NUMBER;
BEGIN
    -- Get balance of source account
    SELECT Balance INTO v_balance
    FROM Accounts
    WHERE AccountID = fromAccountID;

    -- Check if sufficient funds
    IF v_balance >= amount THEN
        -- Deduct from source
        UPDATE Accounts
        SET Balance = Balance - amount,
            LastModified = SYSDATE
        WHERE AccountID = fromAccountID;

        -- Add to target
        UPDATE Accounts
        SET Balance = Balance + amount,
            LastModified = SYSDATE
        WHERE AccountID = toAccountID;

        COMMIT;
    ELSE
        RAISE_APPLICATION_ERROR(-20001, 'Insufficient balance in source account');
    END IF;
END;
/
